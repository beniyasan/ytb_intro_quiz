# システム要件定義書

## 1. プロジェクト概要

### 1.1 システム名
YouTube イントロクイズバトル (YIQ - YouTube Intro Quiz)

### 1.2 目的
YouTube のプレイリストを活用した、リアルタイム早押しイントロクイズ対戦システムの構築

### 1.3 スコープ
- YouTubeプレイリストを使用したクイズ出題
- リアルタイム早押し対戦機能
- マルチプレイヤー対応
- セッション管理機能
- スコアリング・ランキング機能

## 2. ステークホルダー

| ステークホルダー | 役割 | 期待値 |
|----------------|------|--------|
| ホストユーザー | ゲーム主催者 | 簡単なルーム作成、クイズ進行管理 |
| プレイヤー | ゲーム参加者 | スムーズな参加、公平な早押し判定 |
| 観戦者 | 視聴者 | リアルタイムでの観戦体験 |
| システム管理者 | 運用・保守 | 安定運用、監視機能 |

## 3. 機能要件

### 3.1 ユーザー管理機能

#### 3.1.1 ユーザー登録
- **FR-001**: メールアドレスとパスワードによるユーザー登録
- **FR-002**: Googleアカウント連携による登録
- **FR-003**: プロフィール情報の登録（ニックネーム、アバター）

#### 3.1.2 認証機能
- **FR-004**: ログイン/ログアウト機能
- **FR-005**: パスワードリセット機能
- **FR-006**: セッショントークン管理

### 3.2 ルーム管理機能

#### 3.2.1 ルーム作成
- **FR-010**: ホストによるルーム作成
- **FR-011**: セッションコード自動生成（6桁英数字）
- **FR-012**: ルーム設定（最大人数、制限時間、問題数）
- **FR-013**: プライベート/パブリックルーム設定

#### 3.2.2 ルーム参加
- **FR-014**: セッションコードによる参加
- **FR-015**: QRコードによる参加
- **FR-016**: 参加者リストのリアルタイム更新
- **FR-017**: 観戦モードでの参加

### 3.3 クイズ機能

#### 3.3.1 プレイリスト管理
- **FR-020**: YouTubeプレイリストURL入力
- **FR-021**: プレイリスト内容の取得・表示
- **FR-022**: カスタムプレイリスト作成
- **FR-023**: プレイリストの保存・再利用

#### 3.3.2 出題機能
- **FR-024**: ランダム曲選択
- **FR-025**: イントロ部分の自動再生（5-30秒設定可能）
- **FR-026**: 再生位置のランダム化オプション
- **FR-027**: 出題順序のシャッフル

#### 3.3.3 解答機能
- **FR-030**: 早押しボタン機能
- **FR-031**: タイムスタンプ記録（ミリ秒単位）
- **FR-032**: 解答権取得者の表示
- **FR-033**: テキスト入力による解答
- **FR-034**: 選択式解答オプション

#### 3.3.4 判定機能
- **FR-035**: 自動正誤判定（部分一致対応）
- **FR-036**: ホストによる手動判定オプション
- **FR-037**: 正解発表アニメーション
- **FR-038**: 部分点設定機能

### 3.4 スコアリング機能

#### 3.4.1 ポイント計算
- **FR-040**: 正解ポイント付与
- **FR-041**: 早押し順位によるボーナスポイント
- **FR-042**: 連続正解ボーナス
- **FR-043**: リアルタイムスコア更新

#### 3.4.2 ランキング
- **FR-044**: ゲーム内ランキング表示
- **FR-045**: 総合ランキング機能
- **FR-046**: 月間/週間ランキング
- **FR-047**: ランキング履歴保存

### 3.5 コミュニケーション機能

#### 3.5.1 チャット
- **FR-050**: ルーム内チャット機能
- **FR-051**: スタンプ/リアクション機能
- **FR-052**: システムメッセージ表示

#### 3.5.2 通知
- **FR-053**: ゲーム開始/終了通知
- **FR-054**: 参加者入退室通知
- **FR-055**: 正解者通知

## 4. 非機能要件

### 4.1 パフォーマンス要件

| 要件ID | 項目 | 要件値 |
|--------|------|--------|
| NFR-001 | 早押しレスポンス時間 | 50ms以内 |
| NFR-002 | ページロード時間 | 2秒以内 |
| NFR-003 | 同時接続ユーザー数 | 2000人 |
| NFR-004 | 同時ルーム数 | 100ルーム |
| NFR-005 | 1ルームあたり最大人数 | 20人 |
| NFR-006 | WebSocket遅延 | 100ms以内 |

### 4.2 可用性要件

| 要件ID | 項目 | 要件値 |
|--------|------|--------|
| NFR-010 | システム稼働率 | 99.9% |
| NFR-011 | 計画メンテナンス | 月1回、深夜2時間以内 |
| NFR-012 | 障害復旧時間 | 1時間以内 |
| NFR-013 | データバックアップ | 日次自動バックアップ |

### 4.3 セキュリティ要件

| 要件ID | 項目 | 要件内容 |
|--------|------|----------|
| NFR-020 | 通信暗号化 | HTTPS/WSS必須 |
| NFR-021 | 認証方式 | JWT + リフレッシュトークン |
| NFR-022 | パスワード | bcrypt暗号化、8文字以上 |
| NFR-023 | API保護 | Rate Limiting実装 |
| NFR-024 | XSS対策 | 入力値サニタイジング |
| NFR-025 | CSRF対策 | CSRFトークン実装 |

### 4.4 ユーザビリティ要件

| 要件ID | 項目 | 要件内容 |
|--------|------|----------|
| NFR-030 | レスポンシブ対応 | PC/タブレット/スマートフォン対応 |
| NFR-031 | ブラウザ対応 | Chrome, Firefox, Safari, Edge最新版 |
| NFR-032 | アクセシビリティ | WCAG 2.1 Level AA準拠 |
| NFR-033 | 多言語対応 | 日本語、英語 |
| NFR-034 | エラーハンドリング | ユーザーフレンドリーなエラーメッセージ |

### 4.5 拡張性要件

| 要件ID | 項目 | 要件内容 |
|--------|------|----------|
| NFR-040 | 水平スケーリング | Kubernetes対応 |
| NFR-041 | データベース拡張 | シャーディング対応設計 |
| NFR-042 | API拡張性 | RESTful API設計 |
| NFR-043 | プラグイン機構 | 新機能追加の容易性 |

## 5. 制約事項

### 5.1 技術的制約
- YouTube API クォータ制限（1日あたり10,000ユニット）
- YouTube利用規約の遵守
- ブラウザのオートプレイポリシー対応
- WebSocket同時接続数制限

### 5.2 ビジネス制約
- 開発期間: 4ヶ月
- 予算制約
- リリース時期: 2024年Q2予定

### 5.3 法的制約
- 個人情報保護法準拠
- GDPR対応（EU圏ユーザー向け）
- 著作権法遵守

## 6. 前提条件

- ユーザーは安定したインターネット接続環境を持つ
- ユーザーはYouTubeへのアクセスが可能
- システムはクラウド環境（AWS）で運用
- 初期リリースは日本国内向け

## 7. 用語定義

| 用語 | 定義 |
|------|------|
| ホスト | ルームを作成し、ゲームを進行する管理者 |
| プレイヤー | クイズに参加し解答する参加者 |
| セッションコード | ルーム参加用の6桁の識別コード |
| イントロ | 楽曲の冒頭部分（導入部） |
| 早押し | 最も早く解答ボタンを押すこと |
| プレイリスト | YouTube上の楽曲リスト |

## 8. ユースケース図

```
┌─────────────────────────────────────────────┐
│                                             │
│  ┌──────┐        ┌──────────────┐          │
│  │ Host ├────────┤ Create Room  │          │
│  └───┬──┘        └──────────────┘          │
│      │                                      │
│      │           ┌──────────────┐          │
│      ├───────────┤ Start Game   │          │
│      │           └──────────────┘          │
│      │                                      │
│      │           ┌──────────────┐          │
│      └───────────┤ Judge Answer │          │
│                  └──────────────┘          │
│                                             │
│  ┌────────┐      ┌──────────────┐          │
│  │ Player ├──────┤ Join Room    │          │
│  └────┬───┘      └──────────────┘          │
│       │                                     │
│       │          ┌──────────────┐          │
│       ├──────────┤ Push Button  │          │
│       │          └──────────────┘          │
│       │                                     │
│       │          ┌──────────────┐          │
│       └──────────┤ Submit Answer│          │
│                  └──────────────┘          │
│                                             │
│  ┌──────────┐    ┌──────────────┐          │
│  │ Spectator├────┤ Watch Game   │          │
│  └──────────┘    └──────────────┘          │
│                                             │
└─────────────────────────────────────────────┘
```

## 9. 画面遷移図

```
┌──────────┐     ┌───────────┐     ┌──────────┐
│  Login   │────→│   Home    │────→│Create Room│
└──────────┘     └─────┬─────┘     └─────┬────┘
                       │                   │
                       ↓                   ↓
                 ┌───────────┐       ┌──────────┐
                 │ Join Room │       │   Lobby  │
                 └─────┬─────┘       └─────┬────┘
                       │                   │
                       └─────────┬─────────┘
                                 ↓
                          ┌──────────┐
                          │   Game   │
                          └─────┬────┘
                                │
                                ↓
                          ┌──────────┐
                          │  Result  │
                          └──────────┘
```

## 10. 成功基準

- 早押し判定の公平性（50ms以内の処理）
- 同時20人での安定動作
- ユーザー満足度80%以上
- システム稼働率99.9%達成
- 月間アクティブユーザー1000人達成